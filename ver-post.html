<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lendo Post - Low Waste</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header class="nav-bar">
        <div class="nav-text">Low Waste</div>
        <hr>
        <nav class="nav-li">
            <a href="index.html">Voltar para Home</a>
        </nav>
        <hr>
    </header>

    <main class="container">
        <article class="post" id="area-conteudo">
            <p>Carregando post...</p>
        </article>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Blog Low Waste</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
         import { updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        const firebaseConfig = {
            apiKey: "AIzaSyB3IehrenMKz8uJSgea3EaiIhlIDEAtrQw",
            authDomain: "blog-low-wast.firebaseapp.com",
            projectId: "blog-low-wast",
            storageBucket: "blog-low-wast.firebasestorage.app",
            messagingSenderId: "85524783938",
            appId: "1:85524783938:web:c5904c60900c95dc909edb",
            measurementId: "G-BT4F6VCEFM"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function lerPostUnico() {
            // 1. Pega o ID que está na URL (lá no navegador)
            const params = new URLSearchParams(window.location.search);
            const idPost = params.get('id');

            if (!idPost) {
                window.location.href = "index.html"; // Se não tiver ID, volta pra home
                return;
            }

            // 2. Busca esse ID específico no banco
            const docRef = doc(db, "posts", idPost);
            const docSnap = await getDoc(docRef);

            // Dentro da função lerPostUnico() do seu ver-post.html
            if (docSnap.exists()) {
                const post = docSnap.data();
                

                // ... dentro do if (docSnap.exists()) ...
                const postRef = doc(db, "posts", idPost);
                await updateDoc(postRef, {
                    views: increment(1) // SOMA +1 CADA VEZ QUE ALGUÉM ABRE
                });
                // Gerar o conteúdo baseado nos blocos
                let blocosHTML = '';

                // Verifica se o conteúdo é a nova estrutura (array) ou o modelo antigo (string)
                if (Array.isArray(post.conteudo)) {
                    post.conteudo.forEach(bloco => {
                        if (bloco.tipo === 'texto') {
                            blocosHTML += `<p>${bloco.valor.replace(/\n/g, '<br>')}</p>`;
                        } else if (bloco.tipo === 'subtitulo') {
                            blocosHTML += `<h3>${bloco.valor}</h3>`;
                        } else if (bloco.tipo === 'imagem') {
                            blocosHTML += `<div class="post-img-placeholder"><img src="${bloco.valor}"></div>`;
                        }
                    });
                } else {
                    // Fallback para posts antigos que eram apenas texto
                    blocosHTML = `<p>${post.conteudo.replace(/\n/g, '<br>')}</p>`;
                }

                const htmlCompleto = `
        <span class="category">${post.categoria}</span>
        <h1>${post.titulo}</h1>
        <p class="meta">Publicado em ${post.data ? post.data.toDate().toLocaleDateString('pt-BR') : ''}</p>
        <div class="post-img-placeholder"><img src="${post.imagem}"></div>
        <div class="texto-post">
            ${blocosHTML}
        </div>
    `;
                document.getElementById('area-conteudo').innerHTML = htmlCompleto;
            } else {
                document.getElementById('area-conteudo').innerHTML = '<p>Post não encontrado.</p>';
            }
        }

        lerPostUnico();
    </script>
</body>

</html>